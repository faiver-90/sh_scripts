#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
if [ -z "$1" ]; then
  echo "–£–∫–∞–∂–∏—Ç–µ –∏–º—è –≤–µ—Ç–∫–∏ –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç!"
  echo "–ü—Ä–∏–º–µ—Ä: ./git_rebase.sh <branch-name>"
  exit 1
fi

# –ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
BRANCH_NAME=$1

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

echo "–í—ã–ø–æ–ª–Ω—è–µ–º fetch –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π..."
git fetch origin

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–¥–∞–ª–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞
if ! git show-ref --verify --quiet refs/remotes/origin/$BRANCH_NAME; then
  echo "–£–¥–∞–ª—ë–Ω–Ω–∞—è –≤–µ—Ç–∫–∞ '$BRANCH_NAME' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
  exit 1
fi

echo "–í—ã–ø–æ–ª–Ω—è–µ–º rebase '$CURRENT_BRANCH' –Ω–∞ 'origin/$BRANCH_NAME'..."
if git rebase origin/$BRANCH_NAME; then
  echo "‚úÖ Rebase —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!"
else
  echo "‚ùå –í–æ–∑–Ω–∏–∫–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã. –†–µ—à–∏—Ç–µ –∏—Ö –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–µ–±–µ–π–∑:"
  echo "  - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã"
  echo "  - –í—ã–ø–æ–ª–Ω–∏—Ç–µ: git add <—Ñ–∞–π–ª>"
  echo "  - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–µ–±–µ–π–∑: git rebase --continue"
  echo "  - –ß—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–±–µ–π–∑: git rebase --abort"
  echo "  - –ï—Å–ª–∏ –ø—É—à–∏–ª –¥–æ —Ä–µ–±–µ–π–∑–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å push --force-with-lease "
  exit 1
fi

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
echo "üéâ Rebase –∑–∞–≤–µ—Ä—à–µ–Ω –¥–ª—è –≤–µ—Ç–∫–∏ '$CURRENT_BRANCH' –Ω–∞ –æ—Å–Ω–æ–≤–µ '$BRANCH_NAME'."
exit 0
